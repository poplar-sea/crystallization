# 1.Nginx配置文件构成
* 全局块：比如工作进程数，定义日志路径；
* Events块：设置处理轮询事件模型，每个工作进程最大连接数及http层的keep-alive超时时间；
* http块：路由匹配、静态文件服务器、反向代理、负载均衡等

# 2. 全局块
## 2.1 user
* 用于指定运行nginx服务器的用户。
* 它定义了nginx进程所使用的用户身份
* 用于确定nginx进程的权限和安全性。
* 通过指定用户身份，可以控制nginx进程访问系统资源的权限，并确保其符合安全策略
## 2.2 pid
* pid文件内记录着当前Nginx主进程的ID号，可以通过```kill命令```发送信号给该ID号
* 作用：
  * 重新加载Nginx配置文件完成平滑重启：kill -HUP `cat /var/log/nginx.pid`

## 2.3 try_files
* 语法：```try_files path1 [ path2] uri```
* 默认：none
* 按照参数顺序检查文件是否存在，以及返回第一个被找到的文件名
* 以“/”结尾的表示一个目录
* 如果文件没有找到，将被内部重定向到最后一个参数上
# 3. events块

# 4. http块
* 使用环境该指令可以在Nginx配置文件中使用的位置，例如使用环境为```“http, server, location”```，表示该指令可以在以下位置使用：```http { ...... }大括号内```；```server { ...... }大括号内```；```location { ...... }大括号内```
## 4.1 alias
* 语法：alias file-path|directory-path;
* 默认值： no
* 使用环境：location
* 该指令用于在URL和文件系统路径之间实现映射
* 在含有正则表达式的location中，不能使用alias指令
## 4.2 default_type
* 语法：default_type MIME-type
* 默认值：default_type text/plain
* 使用环境：http, server, location
* ```MIME-type```是用来告诉浏览器请求的文件媒体类型的
* 如果Nginx无法识别该文件属于何种MIME-type类型，则将该文件标记为default_type指令设置的MIME-type

## 4.3 error_page
* 语法：error_page code [ code... ] [ = |=answer-code ] uri
* 默认值：no
* 使用环境：http, server, location, if in location
* 该指令用于设置如果出现指定的HTTP错误状态码，则返回给客户端显示的对应URI地址

## 4.4 index 
* 语法：index file [file...]
* 默认值：index index.html
* 使用环境：http, server, location
* 该指令用于设置Nginx的默认首页文件。
## 4.5 location
* 语法：location [=|~|~*|^~] /uri/ { ... }
* 默认值：no
* 使用环境：server
* 配置规则：
  * = 精确匹配 1
  * ^~ 以某个字符串开头 2
  * ~ 区分大小写的正则匹配 3
  * ~* 不区分大小写的正则匹配 4
  * !~ 区分大小写的不匹配正则 5
  * !~* 不区分大小写的不匹配正则 6
  * / 通用匹配，任何请求都会匹配到 7

## 4.6 root
* 语法：root path
* 默认值：root html
* 使用环境：http, server, location, if in location
* 该指令主要用来指定请求的文档根目录。



# 5. 全局变量
* $nginx_version: 当前运行的Nginx版本号
* $pid: 进程ID号
* $realpath_root: Root目录绝对路径
* $url: 这个变量等于当前请求的URI（不带参数），它可以不同于最初的值，例如可以被内部重定向所改变



# 6. 示例
```conf
# 全局块
 user www-data;
 worker_processes  2;  ## 默认1，一般建议设成CPU核数1-2倍
 error_log  logs/error.log; ## 错误日志路径
 pid  logs/nginx.pid; ## 进程id
 
 # Events块
 events {
   # 使用epoll的I/O 模型处理轮询事件。
   # 可以不设置，nginx会根据操作系统选择合适的模型
   use epoll;
   
   # 工作进程的最大连接数量, 默认1024个
   worker_connections  2048;
   
   # http层面的keep-alive超时时间
   keepalive_timeout 60;
   
   # 客户端请求头部的缓冲区大小
   client_header_buffer_size 2k;
 }
 
 # http块
 http { 
 
   include mime.types;  # 导入文件扩展名与文件类型映射表
   default_type application/octet-stream;  # 默认文件类型
   
   # 日志格式及access日志路径
   log_format   main '$remote_addr - $remote_user [$time_local]  $status '
     '"$request" $body_bytes_sent "$http_referer" '
     '"$http_user_agent" "$http_x_forwarded_for"';
   access_log   logs/access.log  main;
   
   # 允许sendfile方式传输文件，默认为off。
   sendfile     on;
   tcp_nopush   on; # sendfile开启时才开启。
 
   # http server块
   # 简单反向代理
   server {
     listen       80;
     server_name  domain2.com www.domain2.com;
     access_log   logs/domain2.access.log  main;
    
     # 转发动态请求到web应用服务器
     location / {
       proxy_pass      http://127.0.0.1:8000;
       deny 192.24.40.8;  # 拒绝的ip
       allow 192.24.40.6; # 允许的ip   
     }
     
     # 错误页面
     error_page   500 502 503 504  /50x.html;
         location = /50x.html {
             root   html;
         }
   }
 
   # 负载均衡
   upstream backend_server {
     server 192.168.0.1:8000 weight=5; # weight越高，权重越大
     server 192.168.0.2:8000 weight=1;
     server 192.168.0.3:8000;
     server 192.168.0.4:8001 backup; # 热备
   }
 
   server {
     listen          80;
     server_name     big.server.com;
     access_log      logs/big.server.access.log main;
     
     charset utf-8;
     client_max_body_size 10M; # 限制用户上传文件大小，默认1M
 
     location / {
       # 使用proxy_pass转发请求到通过upstream定义的一组应用服务器
       proxy_pass      http://backend_server;
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       proxy_set_header Host $http_host;
       proxy_redirect off;
       proxy_set_header X-Real-IP  $remote_addr;
     }
     
   }
 }
```